<?xml version="1.0"?>
<ZopeData>
  <record id="1" aka="AAAAAAAAAAE=">
    <pickle>
      <global name="File" module="OFS.Image"/>
    </pickle>
    <pickle>
      <dictionary>
        <item>
            <key> <string>_EtagSupport__etag</string> </key>
            <value> <string>ts23259624.11</string> </value>
        </item>
        <item>
            <key> <string>__name__</string> </key>
            <value> <string>vifib.js</string> </value>
        </item>
        <item>
            <key> <string>content_type</string> </key>
            <value> <string>application/javascript</string> </value>
        </item>
        <item>
            <key> <string>data</string> </key>
            <value> <string encoding="cdata"><![CDATA[

function setSoftwareReleaseEntry(item, append_to) {\n
  var li = $(\'<li>\');\n
  var img = $(\'<img>\');\n
  var img_div = $(\'<div>\');\n
  var title_div = $(\'<div>\');\n
  var description_div = $(\'<div>\');\n
  var description = $(\'<span>\');\n
  var entry_div = $(\'<div>\');\n
  var navigation_div = $(\'<div>\');\n
  var list = $(\'<ul>\');\n
  var entry_more = $(\'<li>\');\n
  var more = $(\'<a>\');\n
  var entry_request = $(\'<li>\');\n
  var request = $(\'<a>\');\n
  var entry_install = $(\'<li>\');\n
  var install = $(\'<a>\');\n
  img_div.append(img);\n
  entry_more.append(more);\n
  list.append(entry_more);\n
  navigation_div.append(list);\n
  entry_request.append(request);\n
  list.append(entry_request);\n
  entry_install.append(install);\n
  list.append(entry_install);\n
  entry_div.append(img_div);\n
  entry_div.append(title_div);\n
  entry_div.append(description_div);\n
  entry_div.append(navigation_div);\n
  entry_div.append($(\'<div>\').addClass(\'reset\'));\n
  li.append(entry_div);\n
  description_div.append(description);\n
  if (append_to) {li.appendTo(append_to); }\n
  li.addClass(\'software_release_entry\');\n
  img.attr({\n
    \'src\': item.image_url,\n
    \'alt\': item.title,\n
    \'title\': item.title\n
  });\n
  img.addClass(\'software_release_icon\');\n
  img_div.addClass(\'software_release_icon\');\n
  title_div.addClass(\'software_release_title\');\n
  title_div.html(item.title);\n
  description_div.addClass(\'software_release_description\');\n
  navigation_div.addClass(\'software_release_navigation\');\n
  list.addClass(\'software_release_navigation\');\n
  entry_more.addClass(\'software_release_navigation\');\n
  more.attr(\'href\', item.document_url);\n
  more.text(\'Read more\');\n
  more.addClass(\'software_release_navigation\');\n
  entry_request.addClass(\'software_release_navigation\');\n
  request.attr(\'href\', \'#\' + $.param({\'action\': \'request_instance\', \'software_release\': item.uid}));\n
  request.addClass(\'software_release_navigation\');\n
  request.text(\'Request instance\');\n
  entry_install.addClass(\'software_release_navigation\');\n
  install.attr(\'href\', \'#\' + $.param({\'action\': \'install_software\', \'software_release\': item.uid}));\n
  install.addClass(\'software_release_navigation\');\n
  install.text(\'Install software\');\n
  description.addClass(\'software_release_description\');\n
  var maxh = description_div.height();\n
  var added = \'\';\n
  var word_list = item.description.split(\' \');\n
  var length = word_list.length;\n
  var i;\n
  for (i = 0; i < length; i++) {\n
    added = word_list[i];\n
    description.text(description.text() + \' \' + added);\n
    if (description.height() > maxh) {\n
      var text = description.text();\n
      description.text(text.slice(0, text.length - (1 + added.length)) + \'...\');\n
      break;\n
    }\n
  }\n
  entry_div.addClass(\'software_release_entry\');\n
}\n
\n
function hashTo(event) {\n
  window.location.hash = \'#\' + $.param(event.data);\n
}\n
\n
function toggle() {\n
  var el = $(\'ul#\' + $(this)[0].id).filter(\':visible\');\n
  if (el.length > 0) {\n
    $(\'li#\' + el[0].id).addClass(\'software_category_children_collapsed\');\n
    $(\'li#\' + el[0].id).removeClass(\'software_category_children_expanded\');\n
    el.hide();\n
  } else {\n
    $(\'ul#master\').find(\'ul\').hide();\n
    $(\'ul#master\').find(\'li.software_category_children\').removeClass(\'software_category_children_expanded\');\n
    $(\'ul#master\').find(\'li.software_category_children\').addClass(\'software_category_children_collapsed\');\n
    var me = $(\'ul#\' + $(this)[0].id);\n
    do {\n
      me.show();\n
      $(\'li#\' + me[0].id).removeClass(\'software_category_children_collapsed\');\n
      $(\'li#\' + me[0].id).addClass(\'software_category_children_expanded\');\n
      me = me.parent();\n
    } while (me[0].id !== \'master\');\n
\n
  }\n
}\n
\n
function hasher() {\n
  var t = $(this)[0].id.replace(\'_\', \' \', \'g\');\n
  var l = t.split(\' \');\n
  l[0] = \'+\' + l[0];\n
  t = l.join(\' +\');\n
  var query_kw = $.deparam.fragment();\n
  query_kw.software_category = t;\n
  delete query_kw.page;\n
  window.location.hash = \'#\' + $.param(query_kw);\n
  $(\'.software_category_selected\').removeClass(\'software_category_selected\');\n
  $(this).addClass(\'software_category_selected\');\n
}\n
\n
function resetCategoryHash() {\n
  $(\'ul#master\').find(\'ul\').hide();\n
  $(\'ul#master\').find(\'li.software_category_children\').removeClass(\'software_category_children_expanded\');\n
  $(\'ul#master\').find(\'li.software_category_children\').addClass(\'software_category_children_collapsed\');\n
  $(\'.software_category_selected\').removeClass(\'software_category_selected\');\n
  var query_kw = $.deparam.fragment();\n
  delete (query_kw.software_category);\n
  window.location.hash = \'#\' + $.param(query_kw);\n
}\n
\n
function appendSoftwareCategoryTree(data, id) {\n
  var ul = $(\'<ul>\');\n
  ul.addClass(\'software_category\');\n
  if (id !== undefined) {ul.attr(\'id\', id.replace(\' \', \'_\', \'g\')); } else {\n
    ul.attr(\'id\', \'master\');\n
    var reset = $(\'<li>\');\n
    reset.addClass(\'software_category\');\n
    reset.text(\'Reset...\');\n
    reset.click(resetCategoryHash);\n
    ul.append(reset);\n
  }\n
  var i = 0;\n
  var q;\n
  for (q in data) {\n
    var li = $(\'<li>\');\n
    li.addClass(\'software_category\');\n
    li.attr({\'id\': q.replace(\' \', \'_\', \'g\')});\n
    ul.append(li);\n
    var s = q;\n
    var r = appendSoftwareCategoryTree(data[q], q);\n
    if (r) {\n
      ul.append(r);\n
      li.addClass(\'software_category_children software_category_children_collapsed\');\n
      li.click(toggle);\n
    }\n
    li.click(hasher);\n
    li.html(s);\n
    ++i;\n
  }\n
  if (id !== undefined) {ul.hide(); }\n
  if (i > 0) {return ul; } else {return false; }\n
}\n
\n
function drawSoftwareCategoryTree(data) {\n
  var category = $(\'#left_menu\');\n
  category.empty();\n
  category.attr(\'id\', \'software_category\');\n
  category.text(\'Using the tree below you can filter software by categories.\');\n
  category.append(appendSoftwareCategoryTree(data));\n
}\n
\n
function drawSoftwareReleaseList(data) {\n
  $(\'#software_release_container\').empty();\n
  var ul = $(\'<ul>\');\n
  $("#software_release_container").append(ul);\n
  ul.attr(\'id\', \'software_release_list\');\n
  var li;\n
  var navigation_div;\n
  if (data.software_release_list.length > 0) {\n
    $.each(data.software_release_list, function (i, item) {\n
      setSoftwareReleaseEntry(item, ul, false);\n
    });\n
    li = $(\'<li>\').appendTo(ul);\n
    li.addClass(\'software_release_entry\');\n
    li.attr(\'id\', \'end\');\n
    navigation_div = $(\'<div>\');\n
    navigation_div.attr(\'id\', \'navigation_div\');\n
    navigation_div.addClass(\'software_release_more\');\n
    var param = $.deparam.fragment();\n
    var a = $(\'<div>\');\n
    var page = parseInt(data.page, 10);\n
    if (data.after) {\n
      a.addClass(\'sr_right_active\');\n
      param.page = page + 1;\n
      a.click(param, hashTo);\n
    } else { a.addClass(\'sr_right_inactive\'); }\n
    navigation_div.append(a);\n
    var p = $(\'<div>\');\n
    p.addClass(\'software_release_page\');\n
    p.text(\'Page: \' + String(page + 1));\n
    navigation_div.append(p);\n
    a = $(\'<div>\');\n
    param = {};\n
    if (data.before) {\n
      param.page = page - 1;\n
      a.addClass(\'sr_left_active\');\n
      a.click(param, hashTo);\n
    } else { a.addClass(\'sr_left_inactive\'); }\n
    navigation_div.append(a);\n
    li.append(navigation_div);\n
  } else {\n
    li = $(\'<li>\').appendTo(ul);\n
    li.addClass(\'software_release_more\');\n
    navigation_div = $(\'<div>\');\n
    navigation_div.html(\'Sorry, no results.\');\n
    li.append(navigation_div);\n
  }\n
}\n
\n
function searchSoftwareReleaseList(event) {\n
  event.preventDefault();\n
  var query_kw = $.deparam.fragment();\n
  var new_query_kw = {\n
    query: $(\'#software_release_query\')[0].value,\n
    software_category: query_kw.software_category || \'\'\n
  };\n
  window.location.hash = $.param(new_query_kw);\n
}\n
\n
function softwareReleaseController(query, software_category, page) {\n
  var js_container = $("#js_container");\n
  js_container.empty();\n
  var explanation = $(\'<p>\');\n
  explanation.text(\'Use search and categories on left in order to filter Software Releases. It is possible to install Software Release on your computers or request new instance of selected software.\');\n
  js_container.append(explanation);\n
  var search_div = $(\'<div>\');\n
  js_container.append(search_div);\n
  search_div.addClass(\'software_release_search\');\n
  var input = $(\'<input>\');\n
  input.attr({\'id\': "software_release_query", \'placeholder\': \'Click here for search...\', \'type\': \'search\'});\n
  input.val(query);\n
  $(\'form\').submit(searchSoftwareReleaseList);\n
  search_div.append(input);\n
\n
  var search = $(\'<button>\');\n
  search.addClass(\'nolabel validate\');\n
  search.append($(\'<span>\').html(\'Search\'));\n
  search_div.append(search);\n
  var software_release_container = $(\'<div>\');\n
  software_release_container.attr(\'id\', \'software_release_container\');\n
  js_container.append(software_release_container);\n
  search.click(searchSoftwareReleaseList);\n
  var q = {};\n
  if (query) { q.query = query; }\n
  if (software_category) { q.query = (q.query || \'\') + \' \' + software_category; }\n
  if (page) {q.page = page; } else {q.page = 0; }\n
  $.getJSON(vifib.site_url + "/ERP5Site_getSoftwareReleaseListAsJSON", q,\n
    drawSoftwareReleaseList);\n
}\n
\n
function processRequest(event) {\n
  event.preventDefault();\n
  var computer = $(\'#computer\').val();\n
  var url = $(\'#url\').val();\n
  var title = $(\'#software_instance_title\').val();\n
  var xml = $(\'#software_instance_xml\').val();\n
\n
  $.post(vifib.site_url + "/ERP5Site_requestComputerPartitionAsJSON", {\n
    \'software_release_url\': url,\n
    \'title\': title,\n
    \'instance_xml\': xml,\n
    \'computer\': computer\n
  },\n
    function () {\n
      alert(\'Your Software Instance has been requested\');\n
      window.location.hash = \'\';\n
    });\n
}\n
\n
function processInstall(event) {\n
  event.preventDefault();\n
  var computer = $(\'#computer\').val();\n
  var url = $(\'#url\').val();\n
\n
  $.post(vifib.site_url + "/ERP5Site_triggerSoftwareInstallationAsJSON", {\n
    \'software_release_url\': url,\n
    \'computer_reference\': computer\n
  },\n
    function () {\n
      alert(\'Software installation on computer \' + computer + \' has been requested\');\n
      window.location.hash = \'\';\n
    });\n
}\n
\n
function drawInstall(data) {\n
  data = data.software_release_list[0];\n
  var js_container = $("#js_container");\n
  js_container.empty();\n
  var release_div = $(\'<div>\');\n
  var img = $(\'<img>\');\n
  img.attr({\n
    \'src\': data.image_url,\n
    \'alt\': data.title,\n
    \'title\': data.title\n
  });\n
  img.addClass(\'software_release_icon\');\n
  js_container.append(img);\n
  var explanation = $(\'<p>\');\n
  js_container.append(explanation);\n
  explanation.text(\'Please select computer on which you want to install selected software.\');\n
\n
  js_container.append(release_div);\n
  release_div.append($(\'<p>\').html(\'You are requesting installation of: \').append($(\'<span>\').addClass(\'required\').text(data.title)));\n
  release_div.append($(\'<p>\').html(\'Url of release: \').append($(\'<span>\').addClass(\'required\').text(data.url)));\n
  var fieldset = $(\'<fieldset>\');\n
  js_container.append(fieldset);\n
  fieldset.addClass(\'normal\');\n
\n
  var url_a = $(\'<input>\');\n
  url_a.attr({\'value\': data.url, \'name\': \'url\', \'id\': \'url\', \'type\': \'hidden\'});\n
  fieldset.append(url_a);\n
\n
  var computer_label = $(\'<div>\');\n
  fieldset.append(computer_label);\n
  computer_label.addClass(\'field\');\n
  computer_label.append($(\'<label>\').text(\'Computer:\'));\n
\n
  var computer_input = $(\'<select>\');\n
  fieldset.append(computer_input);\n
  computer_input.attr({\'name\': \'computer\', \'id\': \'computer\', \'size\': \'1\'});\n
  fieldset.append(computer_input);\n
\n
  $.getJSON(vifib.site_url + "/ERP5Site_getComputerListAsJSON", function (data) {\n
    var computer_input = $(\'#computer\');\n
    var option = $(\'<option>\');\n
    option.attr(\'value\', \'\');\n
    option.appendTo(computer_input);\n
    $.each(data.computer_list, function (i, item) {\n
      var option = $(\'<option>\');\n
      option.attr(\'value\', item.id);\n
      option.html(item.title + \' (\' + item.id + \')\');\n
      option.appendTo(computer_input);\n
    });\n
  });\n
\n
  var install = $(\'<button>\');\n
  install.append($(\'<span>\').html(\'Install\'));\n
\n
  install.click(processInstall);\n
  js_container.append(install);\n
}\n
\n
function drawRequest(data) {\n
  data = data.software_release_list[0];\n
  var js_container = $("#js_container");\n
  js_container.empty();\n
  var release_div = $(\'<div>\');\n
  var img = $(\'<img>\');\n
  img.attr({\n
    \'src\': data.image_url,\n
    \'alt\': data.title,\n
    \'title\': data.title\n
  });\n
  img.addClass(\'software_release_icon\');\n
  js_container.append(img);\n
  var explanation = $(\'<p>\');\n
  js_container.append(explanation);\n
  explanation.text(\'Please fill software instance title and XML, both are required fields. It will allow you to request instance. Optionally select desired computer.\');\n
\n
  js_container.append(release_div);\n
  release_div.append($(\'<p>\').html(\'You are requesting instance of: \').append($(\'<span>\').addClass(\'required\').text(data.title)));\n
  release_div.append($(\'<p>\').html(\'Url of release: \').append($(\'<span>\').addClass(\'required\').text(data.url)));\n
  var fieldset = $(\'<fieldset>\');\n
  js_container.append(fieldset);\n
  fieldset.addClass(\'normal\');\n
\n
  var url_a = $(\'<input>\');\n
  url_a.attr({\'value\': data.url, \'name\': \'url\', \'id\': \'url\', \'type\': \'hidden\'});\n
  fieldset.append(url_a);\n
\n
  var title_label = $(\'<div>\');\n
  fieldset.append(title_label);\n
  title_label.addClass(\'field required\');\n
  title_label.append($(\'<label>\').text(\'Software Instance Title:\'));\n
  var title_div = $(\'<div>\');\n
  fieldset.append(title_div);\n
  title_div.addClass(\'input\');\n
  var title_input = $(\'<input type="text">\');\n
  title_input.attr(\'id\', \'software_instance_title\');\n
  fieldset.append(title_input);\n
\n
  var xml_label = $(\'<div>\');\n
  fieldset.append(xml_label);\n
  xml_label.addClass(\'field required\');\n
  xml_label.append($(\'<label>\').text(\'Parameter XML:\'));\n
  var xml_div = $(\'<div>\');\n
  fieldset.append(xml_div);\n
  xml_div.addClass(\'input\');\n
  var xml_input = $(\'<textarea>\');\n
  xml_input.attr({\'id\': \'software_instance_xml\', \'cols\': \'80\', \'rows\': \'10\'});\n
  xml_input.html(\'<?xml version="1.0" encoding="utf-8"?>\\n<instance>\\n<parameter id="nbd_ip">2a01:e35:2e27:460:e2cb:4eff:fed9:48dc</parameter>\\n<parameter id="nbd_port">1024</parameter>\\n</instance>\');\n
  xml_div.append(xml_input);\n
\n
\n
  var computer_label = $(\'<div>\');\n
  fieldset.append(computer_label);\n
  computer_label.addClass(\'field\');\n
  computer_label.append($(\'<label>\').text(\'Computer:\'));\n
\n
  var computer_input = $(\'<select>\');\n
  fieldset.append(computer_input);\n
  computer_input.attr({\'name\': \'computer\', \'id\': \'computer\', \'size\': \'1\'});\n
  fieldset.append(computer_input);\n
\n
  $.getJSON(vifib.site_url + "/ERP5Site_getComputerListAsJSON", function (data) {\n
    var computer_input = $(\'#computer\');\n
    var option = $(\'<option>\');\n
    option.attr(\'value\', \'\');\n
    option.appendTo(computer_input);\n
    $.each(data.computer_list, function (i, item) {\n
      var option = $(\'<option>\');\n
      option.attr(\'value\', item.id);\n
      option.html(item.title + \' (\' + item.id + \')\');\n
      option.appendTo(computer_input);\n
    });\n
  });\n
\n
  var request = $(\'<button>\');\n
  request.append($(\'<span>\').html(\'Request\'));\n
\n
  request.click(processRequest);\n
  js_container.append(request);\n
}\n
\n
function installController(software_release_id) {\n
  software_release_id = parseInt(software_release_id, 10);\n
  $.getJSON(\n
    vifib.site_url + "/ERP5Site_getSoftwareReleaseListAsJSON",\n
    {"uid": software_release_id},\n
    drawInstall\n
  );\n
}\n
\n
function requestController(software_release_id) {\n
  software_release_id = parseInt(software_release_id, 10);\n
  $.getJSON(\n
    vifib.site_url + "/ERP5Site_getSoftwareReleaseListAsJSON",\n
    {"uid": software_release_id},\n
    drawRequest\n
  );\n
}\n
\n
function hashController() {\n
  var query_kw = $.deparam.fragment();\n
  var action = query_kw.action || \'software_release_list\';\n
  var software_release = query_kw.software_release;\n
  var query = query_kw.query;\n
  var page = query_kw.page;\n
  switch (action) {\n
    case "request_instance":\n
      requestController(software_release);\n
      break;\n
    case "install_software":\n
      installController(software_release);\n
      break;\n
    default:\n
      softwareReleaseController(query, query_kw.software_category, page)\n
  }\n
}\n
\n
function cleanAjaxError(data, textStatus, jqXHR) {\n
  ajax_error = $(\'#ajax_error\');\n
  if (ajax_error.length > 0) {\n
    ajax_error.empty();\n
  }\n
}\n
\n
function processAjaxError(jqXHR, textStatus, errorThrown) {\n
  ajax_error = $(\'#ajax_error\');\n
  if (ajax_error.length == 0) {\n
    container = $(\'#js_container\');\n
    ajax_error = $(\'<div>\').addClass(\'error\').attr(\'id\', \'ajax_error\');\n
    container.before(ajax_error);\n
  }\n
  ajax_error.empty()\n
  ajax_error.html(\'There was issue with server communication. Please try to reload the page.\');\n
}

]]></string> </value>
        </item>
        <item>
            <key> <string>precondition</string> </key>
            <value> <string></string> </value>
        </item>
        <item>
            <key> <string>size</string> </key>
            <value> <int>16373</int> </value>
        </item>
        <item>
            <key> <string>title</string> </key>
            <value> <string></string> </value>
        </item>
      </dictionary>
    </pickle>
  </record>
</ZopeData>
