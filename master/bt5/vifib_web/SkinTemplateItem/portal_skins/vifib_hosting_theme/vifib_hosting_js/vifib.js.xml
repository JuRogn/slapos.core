<?xml version="1.0"?>
<ZopeData>
  <record id="1" aka="AAAAAAAAAAE=">
    <pickle>
      <global name="File" module="OFS.Image"/>
    </pickle>
    <pickle>
      <dictionary>
        <item>
            <key> <string>_EtagSupport__etag</string> </key>
            <value> <string>ts22124862.69</string> </value>
        </item>
        <item>
            <key> <string>__name__</string> </key>
            <value> <string>vifib.js</string> </value>
        </item>
        <item>
            <key> <string>content_type</string> </key>
            <value> <string>application/javascript</string> </value>
        </item>
        <item>
            <key> <string>data</string> </key>
            <value> <string encoding="cdata"><![CDATA[

function extendSoftwareReleaseList() {\n
  ul = $("#software_release_list")[0];\n
  current = ul.children.length - 1;\n
  q = $(\'#software_release_query\')[0][\'value\']\n
  $.getJSON(\n
  vifib[\'site_url\'] + "/ERP5Site_getSoftwareReleaseListAsJSON",\n
  {"title":q, "offset": current},\n
  drawExtendSoftwareReleaseList);\n
}\n
\n
function drawExtendSoftwareReleaseList(data) {\n
  hook = $(\'#more_end\');\n
  if (data[\'software_release_list\'].length > 0) {\n
    $.each(data[\'software_release_list\'], function(i,item){\n
      setSoftwareReleaseEntry(item, false, hook);\n
    });\n
  }\n
  else\n
  {\n
    $(\'#more_div\').html(\'All results shown.\');\n
  }\n
}\n
\n
function setSoftwareReleaseEntry(item, append_to, insert_before) {\n
  var li = $(\'<li>\');\n
  var img = $(\'<img>\');\n
  var img_div = $(\'<div>\');\n
  var title_div = $(\'<div>\');\n
  var description_div = $(\'<div>\');\n
  var description = $(\'<span>\');\n
  var entry_div = $(\'<div>\');\n
  img_div.append(img);\n
  entry_div.append(img_div);\n
  entry_div.append(title_div);\n
  entry_div.append(description_div);\n
  entry_div.append($(\'<div>\').addClass(\'reset\'));\n
  li.append(entry_div);\n
  description_div.append(description);\n
  if (append_to) {li.appendTo(append_to);}\n
  if (insert_before) {li.insertBefore(insert_before);}\n
  li.addClass(\'software_release_entry\');\n
  li.click(function() {window.location.hash=\'#software_release=\' + item.uid});\n
  img.attr({\n
    \'src\': item.image,\n
    \'alt\': item.title,\n
    \'title\': item.title\n
  });\n
  img.addClass(\'software_release_icon\');\n
  img_div.addClass(\'software_release_icon\');\n
  title_div.addClass(\'software_release_title\');\n
  title_div.html(item.title)\n
  description_div.addClass(\'software_release_description\');\n
  description.addClass(\'software_release_description\');\n
  maxh = description_div.height();\n
  var truncated = false;\n
  var added = \'\';\n
  var word_list = item.description.split(\' \');\n
  var length = word_list.length;\n
  for(i=0; i<length; i++) {\n
    added = word_list[i];\n
    description.text(description.text() + \' \' + added);\n
    if (description.height() > maxh) {\n
      var text = description.text();\n
      description.text(text.slice(0, text.length - (1 + added.length)) + \'...\');\n
      break;\n
    }\n
  }\n
  entry_div.addClass(\'software_release_entry\');\n
}\n
\n
function drawSoftwareReleaseList(data) {\n
  $(\'#software_release_container\').empty()\n
  var ul = $(\'<ul>\');\n
  $("#software_release_container").append(ul);\n
  ul.attr(\'id\', \'software_release_list\');\n
  if (data[\'software_release_list\'].length > 0) {\n
    $.each(data[\'software_release_list\'], function(i,item){\n
      setSoftwareReleaseEntry(item, ul, false)\n
    });\n
    var li = $(\'<li>\').appendTo(ul);\n
    li.addClass(\'software_release_more\');\n
    li.attr(\'id\', \'more_end\');\n
    var more_div = $(\'<div>\');\n
    more_div.attr(\'id\', \'more_div\');\n
    more_div.addClass(\'software_release_more\');\n
    more_div.html(\'More...\');\n
    li.append(more_div);\n
    li.click(extendSoftwareReleaseList);\n
  }\n
  else\n
  {\n
    var li = $(\'<li>\').appendTo(ul);\n
    li.addClass(\'software_release_more\');\n
    var more_div = $(\'<div>\');\n
    more_div.addClass(\'software_release_more\');\n
    more_div.html(\'Sorry, no results.\');\n
    li.append(more_div);\n
  }\n
}\n
\n
function updateSoftwareReleaseList(event) {\n
  event.preventDefault();\n
  query_kw = $.deparam.fragment();\n
  query_kw[\'query\'] = $(\'#software_release_query\')[0][\'value\'];\n
  window.location.hash = $.param(query_kw);\n
}\n
\n
function softwareReleaseController(query) {\n
  js_container = $("#js_container");\n
  js_container.empty();\n
  var input = $(\'<input type="text">\');\n
  input.attr(\'id\', "software_release_query");\n
  input.addClass("software_release_input");\n
  input.val(query);\n
  $(\'form\').submit(updateSoftwareReleaseList);\n
  js_container.append(input);\n
\n
  var search = $(\'<button>\');\n
  search.addClass(\'software_release_input\');\n
  search.append($(\'<span>\').html(\'Search...\'));\n
  input.after(search);\n
  software_release_container = $(\'<div>\');\n
  software_release_container.attr(\'id\', \'software_release_container\');\n
  search.after(software_release_container);\n
  search.click(updateSoftwareReleaseList);\n
  if (query) { q = {\'title\': query}; }\n
  else {q = {};}\n
  $.getJSON(vifib[\'site_url\'] + "/ERP5Site_getSoftwareReleaseListAsJSON", q,\n
  drawSoftwareReleaseList);\n
}\n
\n
function processRequest(event) {\n
  event.preventDefault();\n
  computer = $(\'#computer\').val();\n
  url = $(\'#url\').val();\n
  title = $(\'#software_instance_title\').val();\n
  xml = $(\'#software_instance_xml\').val();\n
\n
  $.post(vifib[\'site_url\'] + "/ERP5Site_requestComputerPartitionAsJSON", {\n
    \'software_release_url\': url,\n
    \'title\': title,\n
    \'instance_xml\': xml,\n
    \'computer\': computer,\n
    },\n
    function () {\n
      alert(\'Your Software Instance has been requested\');\n
      window.location.hash = \'\';\n
    });\n
}\n
\n
function drawRequest(data) {\n
  data = data[\'software_release_list\'][0];\n
  js_container = $("#js_container");\n
  js_container.empty();\n
  url_a = $(\'<input type="hidden">\');\n
  url_a.attr({\'value\': data.url, \'name\': \'url\', \'id\': \'url\'});\n
  js_container.append(url_a);\n
  title_q = $(\'<div>\');\n
  title_q.html(\'Software Instance Title:\');\n
  js_container.append(title_q);\n
  title_a = $(\'<input type="text">\');\n
  title_a.attr(\'id\', \'software_instance_title\');\n
  title_a.addClass(\'software_release_input\');\n
  title_q.append(title_a);\n
\n
  xml_q = $(\'<div>\');\n
  xml_q.html(\'Parameter XML:\');\n
  js_container.append(xml_q);\n
  xml_a = $(\'<textarea>\');\n
  xml_a.attr(\'id\', \'software_instance_xml\');\n
  xml_a.html(\'<?xml version="1.0" encoding="utf-8"?>\\n<instance>\\n<parameter id="nbd_ip">2a01:e35:2e27:460:e2cb:4eff:fed9:48dc</parameter>\\n<parameter id="nbd_port">1024</parameter>\\n</instance>"\')\n
  xml_a.addClass(\'software_release_input\');\n
  xml_q.append(xml_a)\n
\n
  computer_q = $(\'<div>\');\n
  computer_q.html(\'Computer:\');\n
  js_container.append(computer_q);\n
  computer_a = $(\'<select>\');\n
  computer_a.attr({\'name\': \'computer\', \'id\': \'computer\'});\n
  computer_a.addClass(\'software_release_input\');\n
  computer_q.append(computer_a)\n
  $.getJSON(vifib[\'site_url\'] + "/ERP5Site_getComputerListAsJSON", function(data) {\n
    option = $(\'<option>\');\n
    option.attr(\'value\', \'\');\n
    option.appendTo(computer_a);\n
    $.each(data[\'computer_list\'], function(i, item){\n
      computer_a = $(\'#computer\');\n
      option = $(\'<option>\');\n
      option.attr(\'value\', item.id);\n
      option.html(item.title + \' (\' + item.id +\')\');\n
      option.appendTo(computer_a);\n
    });\n
  });\n
  summary = $(\'<div>\');\n
  html = \'Software Release: \' + data.title;\n
  if (data.description.length>0) {\n
      html += \' (\' + data.description + \')\';\n
  }\n
  html += \' url: \' + data.url;\n
  summary.html(html)\n
  js_container.append(summary);\n
  request = $(\'<button>\');\n
  request.append($(\'<span>\').html(\'Request\'));\n
  request.addClass(\'software_release_input\');\n
  request.click(processRequest);\n
  js_container.append(request);\n
}\n
\n
function requestController(software_release_id) {\n
  software_release_id = parseInt(software_release_id);\n
  $.getJSON(\n
  vifib[\'site_url\'] + "/ERP5Site_getSoftwareReleaseListAsJSON",\n
  {"uid":software_release_id},\n
  drawRequest);\n
}\n
\n
function hashController ()\n
{\n
  query_kw = $.deparam.fragment();\n
  software_release = query_kw[\'software_release\'];\n
  query = query_kw[\'query\'];\n
  if (software_release) { requestController(software_release);}\n
  else {softwareReleaseController(query);}\n
//  $(window).load(function() {$(\'div.software_release_title\').dotdotdot();});\n
//  $(window).ajaxComplete(function() {$(\'div.software_release_title\').dotdotdot();});\n
}\n


]]></string> </value>
        </item>
        <item>
            <key> <string>precondition</string> </key>
            <value> <string></string> </value>
        </item>
        <item>
            <key> <string>size</string> </key>
            <value> <int>7427</int> </value>
        </item>
        <item>
            <key> <string>title</string> </key>
            <value> <string></string> </value>
        </item>
      </dictionary>
    </pickle>
  </record>
</ZopeData>
